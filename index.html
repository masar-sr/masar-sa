<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title> طلبات مسار - طلب مشروعك</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');

        :root {
            --primary-gradient: linear-gradient(135deg, #192464 0%, #1e2a78 25%, #0f1a4a 50%, #192464 75%, #2a3b8f 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --accent-blue: #4fc3f7;
            --accent-purple: #ab47bc;
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.12);
            --shadow-deep: 0 20px 60px rgba(0, 0, 0, 0.3);
            --border-radius: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--primary-gradient); background-size: 400% 400%;
            background-attachment: fixed; animation: gradient-shift 20s ease infinite;
            min-height: 100vh; padding: 20px; position: relative; overflow-x: hidden;
        }
        body::before { content: ''; position: fixed; inset: 0; z-index: -2;
            background: 
                radial-gradient(circle at 20% 30%, rgba(79, 195, 247, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(171, 71, 188, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 90%, rgba(76, 175, 80, 0.1) 0%, transparent 50%);
            animation: float-orbs 25s ease-in-out infinite;
        }
        body::after { content: ''; position: fixed; bottom: 0; left: 0; width: 100%; height: 200px; z-index: -1;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath d='M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z' fill='%23ffffff' fill-opacity='0.08'/%3E%3C/path%3E%3C/svg%3E");
            background-size: cover; background-repeat: no-repeat; animation: wave-motion 15s ease-in-out infinite;
        }

        .container { max-width: 900px; margin: 0 auto; position: relative; }

        .header { text-align: center; margin-bottom: 40px; padding: 40px 0; }

        .logo-section { margin-bottom: 30px; }
        .logo-icon { width: 80px; height: 80px; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;
            box-shadow: var(--shadow-deep); animation: logo-pulse 3s ease-in-out infinite; }
        .logo-icon i { font-size: 2.5rem; color: white; }

        .main-title { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; color: var(--text-primary); margin-bottom: 15px;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); background: linear-gradient(45deg, #fff, var(--accent-blue));
            background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { font-size: 1.2rem; color: var(--text-secondary); font-weight: 400; max-width: 600px; margin: 0 auto; line-height: 1.6; }

        .form-card { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 24px; padding: 50px; box-shadow: var(--shadow-deep);
            position: relative; overflow: hidden; }
        .form-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); }

        .progress-indicator { display: flex; justify-content: center; margin-bottom: 40px; gap: 15px; }
        .progress-step { width: 40px; height: 4px; border-radius: 2px; background: rgba(255, 255, 255, 0.2); transition: all 0.3s ease; }
        .progress-step.active { background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); box-shadow: 0 0 10px rgba(79, 195, 247, 0.5); }

        .form-section { margin-bottom: 35px; opacity: 0; transform: translateY(20px); animation: slide-up 0.6s ease forwards; }
        .form-section:nth-child(1) { animation-delay: 0.1s; }
        .form-section:nth-child(2) { animation-delay: 0.2s; }
        .form-section:nth-child(3) { animation-delay: 0.3s; }
        .form-section:nth-child(4) { animation-delay: 0.4s; }
        .form-section:nth-child(5) { animation-delay: 0.5s; }

        .form-label { display: flex; align-items: center; gap: 10px; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; font-size: 1.1rem; }
        .form-label i { font-size: 1.2rem; color: var(--accent-blue); }
        .required-star { color: #ff6b6b; font-weight: bold; margin-right: 5px; }

        .input-wrapper { position: relative; margin-bottom: 8px; }
        .form-input, .form-select, .form-textarea {
            width: 100%; padding: 18px 24px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius); color: var(--text-primary); font-size: 1rem; font-family: inherit;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); backdrop-filter: blur(10px);
        }
        .form-select option { background: transparent; color: #333; padding: 12px; font-size: 1rem; }
        .form-select option:hover { background: rgba(0, 0, 0, 0.1); }
        .form-input:focus, .form-select:focus, .form-textarea:focus { outline: none; border-color: var(--accent-blue); background: rgba(255, 255, 255, 0.15); box-shadow: 0 0 0 4px rgba(79, 195, 247, 0.2); transform: translateY(-2px); }
        .form-input::placeholder, .form-textarea::placeholder { color: rgba(255, 255, 255, 0.6); }
        .form-textarea { min-height: 120px; resize: vertical; line-height: 1.6; }

        .dynamic-field { opacity: 0; max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); margin-top: 0; }
        .dynamic-field.show { opacity: 1; max-height: 200px; margin-top: 25px; }

        .field-hint { font-size: 0.9rem; color: var(--text-secondary); margin-top: 8px; display: flex; align-items: center; gap: 6px; }
        .field-hint i { font-size: 0.8rem; color: var(--accent-blue); }

        .premium-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; background: linear-gradient(135deg, #ffd700, #ffb300); color: #333; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-right: 10px; }

        .submit-section { margin-top: 50px; text-align: center; }
        .submit-button {
            background: linear-gradient(135deg, var(--success-color) 0%, #66bb6a 100%); color: white; border: none; padding: 20px 60px;
            font-size: 1.2rem; font-weight: 700; border-radius: var(--border-radius); cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden; text-transform: uppercase; letter-spacing: 1px; box-shadow: var(--shadow-soft); min-width: 250px;
        }
        .submit-button::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition: left 0.5s; }
        .submit-button:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(76, 175, 80, 0.4); }
        .submit-button:hover::before { left: 100%; }
        .submit-button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: var(--shadow-soft); }

        .loading-overlay { position: fixed; inset: 0; background: rgba(25, 36, 100, 0.9); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .loading-content { text-align: center; color: white; }
        .spinner { width: 60px; height: 60px; border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        .loading-text { font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; }
        .loading-progress { width: 200px; height: 4px; background: rgba(255, 255, 255, 0.2); border-radius: 2px; overflow: hidden; margin: 0 auto; }
        .loading-bar { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple)); width: 0%; animation: loading-progress 3s ease-in-out; }

        .message-card { margin-bottom: 30px; padding: 25px; border-radius: var(--border-radius); backdrop-filter: blur(10px); border: 1px solid; display: none; animation: message-slide 0.5s ease; }
        .message-success { background: rgba(76, 175, 80, 0.15); border-color: var(--success-color); color: #e8f5e8; }
        .message-error { background: rgba(244, 67, 54, 0.15); border-color: var(--error-color); color: #ffebee; }
        .message-icon { font-size: 1.5rem; margin-left: 15px; float: right; }

        .request-id-display { background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 193, 7, 0.1)); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: var(--border-radius); padding: 20px; margin: 20px 0; text-align: center; }
        .request-id-label { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 8px; }
        .request-id-number { font-size: 1.8rem; font-weight: 900; color: #ffd700; font-family: 'Courier New', monospace; letter-spacing: 2px; }

        .whatsapp-button { 
            background: linear-gradient(135deg, #25d366, #128c7e); color: white; border: none; padding: 15px 30px;
            font-size: 1rem; font-weight: 600; border-radius: var(--border-radius); cursor: pointer; 
            margin-top: 15px; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 10px;
        }
        .whatsapp-button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(37, 211, 102, 0.4); }

        @keyframes gradient-shift { 0%, 100% { background-position: 0% 50%; } 25% { background-position: 100% 50%; } 50% { background-position: 50% 100%; } 75% { background-position: 0% 100%; } }
        @keyframes float-orbs { 0%, 100% { transform: translate(0px, 0px) rotate(0deg); } 33% { transform: translate(30px, -30px) rotate(120deg); } 66% { transform: translate(-20px, 20px) rotate(240deg); } }
        @keyframes wave-motion { 0%, 100% { transform: translateX(0px) scale(1); } 50% { transform: translateX(50px) scale(1.05); } }
        @keyframes logo-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes loading-progress { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }
        @keyframes message-slide { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .form-card { padding: 30px 20px; }
            .main-title { font-size: 2.5rem; }
            .submit-button { padding: 16px 40px; font-size: 1.1rem; }
        }
        @media (max-width: 480px) {
            .form-card { padding: 25px 15px; }
            .main-title { font-size: 2rem; }
            .submit-button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <div class="logo-icon"><i class="fas fa-graduation-cap"></i></div>
                <h1 class="main-title"> طلبات مسار</h1>
                <p class="subtitle">خدمات أكاديمية احترافية مع ضمان الجودة والسرعة في التسليم</p>
            </div>
        </div>

        <div class="form-card">
            <div class="progress-indicator">
                <div class="progress-step active"></div>
                <div class="progress-step"></div>
                <div class="progress-step"></div>
                <div class="progress-step"></div>
                <div class="progress-step"></div>
            </div>

            <div id="messageContainer"></div>

            <form id="projectForm" action="https://formspree.io/f/myzngjkp" method="POST" novalidate>
                <!-- نوع المشروع -->
                <div class="form-section">
                    <label class="form-label"><i class="fas fa-folder-open"></i> نوع المشروع <span class="required-star">*</span></label>
                    <div class="input-wrapper">
                        <select id="projectType" name="project_type" class="form-select" required>
                            <option value="">اختر نوع المشروع المطلوب</option>
                            <option value="واجب">📝 واجب أكاديمي</option>
                            <option value="بحث">🔍 بحث علمي</option>
                            <option value="سيسكو">🌐 سيسكو</option>
                            <option value="بوربوينت">📊 عرض بوربوينت</option>
                            <option value="وورد">📄 مستند وورد</option>
                        </select>
                    </div>
                    <div class="field-hint"><i class="fas fa-info-circle"></i> اختر النوع الذي يناسب مشروعك الأكاديمي</div>
                </div>

                <!-- عدد الشرائح لبوربوينت -->
                <div class="form-section dynamic-field" id="slidesGroup">
                    <label class="form-label"><i class="fas fa-chart-bar"></i> عدد الشرائح <span class="required-star">*</span></label>
                    <div class="input-wrapper">
                        <select id="slidesCount" name="slides_count" class="form-select">
                            <option value="">حدد عدد الشرائح المطلوبة</option>
                            <option value="5-10">5-10 شرائح</option>
                            <option value="11-15">11-15 شريحة</option>
                            <option value="16-20">16-20 شريحة</option>
                            <option value="21-30">21-30 شريحة</option>
                            <option value="أكثر من 30">أكثر من 30 شريحة</option>
                            <option value="حسب المحتوى">حسب المحتوى المطلوب</option>
                        </select>
                    </div>
                </div>

                <!-- مستوى التصميم بعد اختيار عدد الشرائح -->
                <div class="form-section dynamic-field" id="presentationTypeGroup">
                    <label class="form-label"><i class="fas fa-star"></i> مستوى التصميم <span class="required-star">*</span></label>
                    <div class="input-wrapper">
                        <select id="presentationType" name="presentation_type" class="form-select">
                            <option value="">اختر مستوى التصميم</option>
                            <option value="أساسي">🟢 أساسي - تصميم بسيط وواضح</option>
                            <option value="احترافي">⭐ احترافي - تصميم متقدم ومتطور</option>
                        </select>
                    </div>
                    <div class="field-hint"><i class="fas fa-palette"></i> التصميم الاحترافي يشمل رسوم بيانية متقدمة وتأثيرات بصرية</div>
                </div>

                <!-- عدد صفحات الوورد -->
                <div class="form-section dynamic-field" id="wordPagesGroup">
                    <label class="form-label"><i class="fas fa-file-word"></i> عدد الصفحات <span class="required-star">*</span></label>
                    <div class="input-wrapper">
                        <select id="wordPages" name="word_pages" class="form-select">
                            <option value="">حدد عدد الصفحات المطلوبة</option>
                            <option value="1-5">1-5 صفحات</option>
                            <option value="6-10">6-10 صفحات</option>
                            <option value="11-20">11-20 صفحة</option>
                            <option value="21-30">21-30 صفحة</option>
                            <option value="أكثر من 30">أكثر من 30 صفحة</option>
                            <option value="حسب المحتوى">حسب المحتوى المطلوب</option>
                        </select>
                    </div>
                </div>

                <!-- الاسم -->
                <div class="form-section">
                    <label class="form-label"><i class="fas fa-user"></i> الاسم الكامل <span class="required-star">*</span></label>
                    <div class="input-wrapper">
                        <input type="text" id="name" name="name" class="form-input" placeholder="أدخل اسمك الكامل" required />
                    </div>
                </div>

                <!-- الهاتف -->
                <div class="form-section">
                    <label class="form-label"><i class="fas fa-mobile-alt"></i> رقم التواصل <span class="required-star">*</span></label>
                    <div class="input-wrapper">
                        <input type="tel" id="phone" name="phone" class="form-input" placeholder="05xxxxxxxx" inputmode="numeric" pattern="05\d{8}" required />
                    </div>
                    <div class="field-hint"><i class="fas fa-shield-alt"></i> رقمك محمي ولن يستخدم إلا للتواصل بخصوص المشروع</div>
                </div>

                <!-- التفاصيل -->
                <div class="form-section">
                    <label class="form-label"><i class="fas fa-clipboard-list"></i> تفاصيل الطلب</label>
                    <div class="input-wrapper">
                        <textarea id="details" name="details" class="form-textarea" placeholder=" تفاصيل المشروع مثل:&#10;- الموضوع المطلوب&#10;- عدد الصفحات أو الشرائح&#10;- تاريخ التسليم المطلوب&#10;- أي متطلبات خاص"></textarea>
                    </div>
                    <div class="field-hint"><i class="fas fa-lightbulb"></i> التفاصيل الواضحة تساعدنا في تقديم أفضل خدمة</div>
                </div>

                <!-- حقول مخفية لـ Formspree -->
                <input type="hidden" id="requestId" name="request_id" />
                <input type="hidden" name="_subject" value="طلب مشروع جديد - طلبات مسار" />
                <input type="hidden" name="_format" value="plain" />
                
                <div class="submit-section">
                    <button type="submit" class="submit-button" id="submitBtn">
                        <i class="fas fa-rocket" style="margin-left:10px"></i> إرسال الطلب
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">جاري معالجة طلبك...</div>
            <div class="loading-progress"><div class="loading-bar"></div></div>
        </div>
    </div>

    <script>
        // إعدادات الواتساب - ضع هنا رقم الواتساب الخاص بك
        const WHATSAPP_NUMBER = '966500000000'; // غيّر هذا الرقم إلى رقمك

        let currentStep = 1;
        const stepsEls = document.querySelectorAll('.progress-step');
        const form = document.getElementById('projectForm');
        const projectTypeEl = document.getElementById('projectType');
        const slidesGroup = document.getElementById('slidesGroup');
        const presentationTypeGroup = document.getElementById('presentationTypeGroup');
        const wordPagesGroup = document.getElementById('wordPagesGroup');
        const slidesSelect = document.getElementById('slidesCount');
        const presentationTypeSelect = document.getElementById('presentationType');
        const wordPagesSelect = document.getElementById('wordPages');
        const nameEl = document.getElementById('name');
        const phoneEl = document.getElementById('phone');
        const detailsEl = document.getElementById('details');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const messageContainer = document.getElementById('messageContainer');
        const requestIdEl = document.getElementById('requestId');

        function updateProgress(step) {
            stepsEls.forEach((el, i) => el.classList.toggle('active', i < step));
        }
        updateProgress(currentStep);

        function showMessage(type, html) {
            messageContainer.innerHTML = `
                <div class="message-card message-${type}" id="messageCard">
                    <span class="message-icon">${type === 'success' ? '✅' : '⚠️'}</span>
                    <div>${html}</div>
                </div>`;
            const card = document.getElementById('messageCard');
            card.style.display = 'block';
        }

        function generateRequestId() {
            const now = new Date();
            const pad = (n) => String(n).padStart(2, '0');
            const y = now.getFullYear();
            const m = pad(now.getMonth() + 1);
            const d = pad(now.getDate());
            const rand = Math.random().toString(36).slice(2, 6).toUpperCase();
            return `REQ-${y}${m}${d}-${rand}`;
        }

        function sendToWhatsApp(data) {
            let message = `🎓 طلب مشروع جديد من طلبات مسار\n\n`;
            message += `📋 رقم الطلب: ${data.requestId}\n`;
            message += `👤 الاسم: ${data.name}\n`;
            message += `📱 الهاتف: ${data.phone}\n`;
            message += `📁 نوع المشروع: ${data.projectType}\n`;
            
            if (data.slidesCount) {
                message += `📊 عدد الشرائح: ${data.slidesCount}\n`;
            }
            if (data.presentationType) {
                message += `🎨 مستوى التصميم: ${data.presentationType}\n`;
            }
            if (data.wordPages) {
                message += `📄 عدد الصفحات: ${data.wordPages}\n`;
            }
            if (data.details) {
                message += `\n📝 التفاصيل:\n${data.details}\n`;
            }
            
            message += `\n⏰ وقت الطلب: ${new Date().toLocaleString('ar-SA')}`;
            
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // تبديل الحقول حسب نوع المشروع
        projectTypeEl.addEventListener('change', function () {
            [slidesGroup, presentationTypeGroup, wordPagesGroup].forEach((g) => g.classList.remove('show'));
            [slidesSelect, presentationTypeSelect, wordPagesSelect].forEach((s) => { 
                s.removeAttribute('required'); 
                s.value = ''; 
            });

            currentStep = 2; 
            updateProgress(currentStep);

            setTimeout(() => {
                if (this.value === 'بوربوينت') {
                    slidesGroup.classList.add('show');
                    slidesSelect.setAttribute('required', 'required');
                } else if (this.value === 'وورد') {
                    wordPagesGroup.classList.add('show');
                    wordPagesSelect.setAttribute('required', 'required');
                } else if (this.value) {
                    currentStep = 3; 
                    updateProgress(currentStep);
                }
            }, 100);
        });

        slidesSelect.addEventListener('change', function () {
            if (this.value && projectTypeEl.value === 'بوربوينت') {
                setTimeout(() => {
                    presentationTypeGroup.classList.add('show');
                    presentationTypeSelect.setAttribute('required', 'required');
                }, 100);
                currentStep = 3; 
                updateProgress(currentStep);
            }
        });

        presentationTypeSelect.addEventListener('change', function () {
            if (this.value) { 
                currentStep = 4; 
                updateProgress(currentStep); 
            }
        });

        wordPagesSelect.addEventListener('change', function () {
            if (this.value) { 
                currentStep = 3; 
                updateProgress(currentStep); 
            }
        });

        nameEl.addEventListener('input', function () {
            if (this.value.trim().length > 2) { 
                currentStep = Math.max(currentStep, 4); 
                updateProgress(currentStep); 
            }
        });

        // تنسيق رقم الجوال السعودي والتحقق
        phoneEl.addEventListener('input', function (e) {
            let v = e.target.value.replace(/\D/g, ''); // أرقام فقط
            if (v.length > 10) v = v.slice(0, 10);
            // فرض البدء بـ 05
            if (v.length >= 1 && v[0] !== '0') v = '0' + v;
            if (v.length >= 2 && v.slice(0,2) !== '05') v = '05' + v.slice(2);
            e.target.value = v;

            // تحديث شريط التقدم عند صلاحية الرقم
            const valid = /^05\d{8}$/.test(v);
            if (valid) { 
                currentStep = 5; 
                updateProgress(currentStep); 
            }
        });

        function validateDynamicFields() {
            const type = projectTypeEl.value;
            if (!type) return { ok: false, msg: 'فضلاً اختر نوع المشروع.' };
            if (type === 'بوربوينت') {
                if (!slidesSelect.value) return { ok: false, msg: 'حدد عدد الشرائح لعرض البوربوينت.' };
                if (!presentationTypeSelect.value) return { ok: false, msg: 'اختر مستوى التصميم (أساسي/احترافي).' };
            }
            if (type === 'وورد') {
                if (!wordPagesSelect.value) return { ok: false, msg: 'حدد عدد صفحات مستند الوورد.' };
            }
            return { ok: true };
        }

        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            
            const dynamicCheck = validateDynamicFields();
            if (!dynamicCheck.ok) {
                showMessage('error', dynamicCheck.msg);
                return;
            }
            if (!nameEl.value.trim()) { 
                showMessage('error', 'اكتب اسمك الكامل.'); 
                return; 
            }
            if (!/^05\d{8}$/.test(phoneEl.value)) { 
                showMessage('error', 'رقم الجوال غير صحيح. يجب أن يكون 10 أرقام ويبدأ بـ 05.'); 
                return; 
            }

            // إنشاء رقم الطلب
            const requestId = generateRequestId();
            requestIdEl.value = requestId;

            // جمع البيانات
            const data = {
                requestId: requestId,
                projectType: projectTypeEl.value,
                slidesCount: slidesSelect.value || null,
                presentationType: presentationTypeSelect.value || null,
                wordPages: wordPagesSelect.value || null,
                name: nameEl.value.trim(),
                phone: phoneEl.value.trim(),
                details: detailsEl.value.trim() || 'لا توجد تفاصيل إضافية',
                createdAt: new Date().toISOString()
            };

            // شاشة التحميل
            loadingOverlay.style.display = 'flex';

            try {
                // إرسال إلى Formspree
                const formData = new FormData(form);
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                loadingOverlay.style.display = 'none';

                if (response.ok) {
                    // إظهار رسالة النجاح
                    const idHtml = `
                        <div class="request-id-display">
                            <div class="request-id-label">رقم طلبك</div>
                            <div class="request-id-number">${data.requestId}</div>
                        </div>`;

                    const whatsappButtonHtml = `
                        <button type="button" class="whatsapp-button" onclick="sendToWhatsApp(${JSON.stringify(data).replace(/"/g, '&quot;')})">
                            <i class="fab fa-whatsapp"></i> إرسال إلى الواتساب أيضاً
                        </button>`;

                    showMessage('success', `تم إرسال طلبك بنجاح إلى الإيميل ✅${idHtml}<div>سنقوم بالتواصل معك قريباً عبر الرقم: <b>${data.phone}</b></div>${whatsappButtonHtml}`);

                    // إعادة تعيين النموذج
                    form.reset();
                    [slidesGroup, presentationTypeGroup, wordPagesGroup].forEach((g) => g.classList.remove('show'));
                    [slidesSelect, presentationTypeSelect, wordPagesSelect].forEach((s) => { 
                        s.removeAttribute('required'); 
                        s.value = ''; 
                    });
                    currentStep = 1; 
                    updateProgress(currentStep);

                    // إرسال تلقائي للواتساب بعد 3 ثوانِ
                    setTimeout(() => {
                        sendToWhatsApp(data);
                    }, 3000);

                } else {
                    const errorData = await response.json().catch(() => ({}));
                    showMessage('error', 'حدث خطأ أثناء إرسال الطلب. يرجى المحاولة مرة أخرى أو التواصل معنا مباشرة.');
                }
            } catch (error) {
                loadingOverlay.style.display = 'none';
                showMessage('error', 'حدث خطأ في الاتصال. تأكد من اتصالك بالإنترنت وحاول مرة أخرى.');
            }
        });

    </script>
</body>
</html>
